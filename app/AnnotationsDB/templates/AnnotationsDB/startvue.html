{% extends 'main/basis.html' %}
{% load staticfiles %}
{% load dioeTags %}
{% load crispy_forms_tags %}
{% block title %} - Annotation (VUE){% endblock %}
{% block ueberschrift %} - Annotation (VUE){% endblock %}
{% block sitecss %}
	<link href="{% static "db/css/tagsystemvue.css" %}?{% settings_value "CACH_RANDOM" %}" rel="stylesheet">
	<link href="{% static "annotationsdb/css/annotationvue.css" %}?{% settings_value "CACH_RANDOM" %}" rel="stylesheet">
{% endblock %}
{% block inhalt %}
<div id="annotationsTool" v-bind:class="{ loading: loading, bgloading: !annotationsTool.loaded, vuerunning: true }">
	<div class="h100 vueapp">
		<div class="row h100">
			<div class="col-md-2 h100 mh200px vscroller lmfa">
				<div class="suchgroup" v-if="annotationsTool.aPK>0&&showSuche">
					<h4>Suchen:<a href="#" v-on:click.prevent="showSuche=false" class="pull-right"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a></h4>
					<div class="lmfasff">
						<div class="iwdbtn">
							<input v-on:keyup="sucheCatchKeyUp" v-on:keydown="sucheCatchKeyDown" id="suchtext" type="text" size="20" class="lmfasf" placeholder="Suchen ..." v-model="suchText">
							<button class="idbtn" title="Eingabe loeschen!" @click="suchText=''"><span class="glyphicon glyphicon-erase" aria-hidden="true"></span></button>
						</div>
					</div>
					<select size="1" class="form-control" v-model="suchInf" @change="suche()">
						<option value="0">Alle Informanten</option>
						<option v-for="(aInf, aInfKey) in aInformanten" :value="aInfKey">${ aInf.k }</option>
					</select>
					<div v-if="suchTokens.length" class="mit10">
						Gefunden: <b>${ suchTokens.length }</b> Token${ ((suchTokens.length>1)?'s':'') }<br>
						<a href="#" v-on:click.prevent="sucheZuAuswahlListe" v-if="suchInf>0" class="lmfabc text-center">Alle Funde ${ ((selTokenListe.length>0) ? 'in' : 'als') } Auswahl Liste</a>
					</div>
					<hr>
				</div>
				<div class="infgroup" v-if="annotationsTool.aPK>0">
					{% include "AnnotationsDB/annotationsinfos.html" %}
				</div>
				<div class="selgroup">
					{% include "AnnotationsDB/annotationsmenue.html" %}
				</div>
			</div>
			<div class="col-md-10 h100 mh600px" style="border-right:1px solid #eee;padding:0px;padding-bottom:150px;" @click="focusFocusCatch">
				<input id="focuscatch" v-on:keyup="focusCatchKeyUp" v-on:keydown="focusCatchKeyDown" />
				<div id="svgscroller" class="h100 mcon vscroller">
					{% include "AnnotationsDB/annotationsvg.html" %}
				</div>
				<svg style="position:absolute;right:0px;bottom:0px;width:1px;height:1px;"><text id="svg-text-textsize" x="-100" y="-100"></text></svg>
				<div class="audioplayer-at">
					<annotationsaudioplayer :audiofile="aEinzelErhebung.dp+aEinzelErhebung.af" @audiopos="setAudioPos($event)" @audioduration="setAudioDuration($event)" v-if="aEinzelErhebung.af" @ctrlkey="ctrlKey" />
				</div>
				<div id="loadsym"><span class="glyphicon glyphicon-refresh gly-spin" aria-hidden="true"></span><div>${ parseInt(99/aTmNr*annotationsTool.nNr) } %</div></div>
			</div>
		</div>
		<div id="loading">Lade ...</div>
		{% include "AnnotationsDB/annotationsmodale.html" %}
	</div>
	<div class="h100 text-center vueloading"><br><br>VUE wird geladen ... das sollte maximal eine Minute dauern!</div>
</div>

{% include "AnnotationsDB/audioplayervue.html" %}
{% include "DB/tagsystemvue.html" %}

<style>
	html,body,body>.container { height:100%; }
</style>
{% endblock %}
{% block sitejs %}
<script>
	var csrf='{{ csrf_token }}';
	var audiodir = '{% settings_value "AUDIO_URL" %}';
</script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.5"></script>
<script src="{% static "main/js/lodash.min.js" %}"></script>
<script src="{% static "annotationsdb/js/audioplayervue.js" %}?{% settings_value "CACH_RANDOM" %}"></script>
<script src="{% static "db/js/tagsystemvue.js" %}?{% settings_value "CACH_RANDOM" %}"></script>
<script src="{% static "annotationsdb/js/scriptsvue.js" %}?{% settings_value "CACH_RANDOM" %}"></script>
{% endblock %}
